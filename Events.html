<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Events | TBCreates</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #0a0a0a;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    main {
      flex-grow: 1;
    }
    /* Animated underline for nav links */
    .nav-link {
      position: relative;
      overflow: hidden;
    }
    .nav-underline {
      display: block;
      position: absolute;
      left: 50%;
      bottom: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, #22d3ee 0%, #22c55e 100%);
      transition: width 0.3s cubic-bezier(.4,0,.2,1), left 0.3s cubic-bezier(.4,0,.2,1);
    }
    .nav-link:hover .nav-underline,
    .nav-link:focus .nav-underline {
      width: 100%;
      left: 0;
    }
    /* Dropdown animation and visibility */
    #discordProfile .dropdown-visible {
      opacity: 1 !important;
      pointer-events: auto !important;
      transition: opacity 0.2s;
      z-index: 100;
      display: block !important;
    }
    #discordProfile .dropdown-hidden {
      opacity: 0 !important;
      pointer-events: none !important;
      transition: opacity 0.2s;
      z-index: 100;
      display: none !important;
    }
    .fade-page {
      opacity: 1;
      transition: opacity 0.4s cubic-bezier(.4,0,.2,1);
    }
    .fade-page.fade-out {
      opacity: 0;
      pointer-events: none;
    }
  </style>
</head>
<body class="text-white font-sans antialiased bg-gradient-to-br from-[#10151c] via-[#18181b] to-[#0a0a0a] fade-page" id="fadePage">

  <!-- NAVBAR -->
  <header class="w-full flex justify-center pt-6 pb-2">
    <nav class="bg-[#191922]/95 backdrop-blur-lg rounded-2xl border border-[#232323] shadow-xl w-full max-w-6xl px-4 sm:px-10 py-4 flex items-center justify-between">
      <!-- Logo/Brand -->
      <a href="index.html" class="flex items-center space-x-3 group focus:outline-none focus:ring-2 focus:ring-green-400 rounded-xl">
        <img src="https://cdn.discordapp.com/attachments/1311731875970289696/1381236274601660456/LOGO_2.png?ex=6846c805&is=68457685&hm=62072bd1ad22defcfb2ce11deb07e4554af23f72f493642d1fb30908c5ae6680&" alt="Logo" class="w-10 h-10 transition-transform group-hover:scale-105">
        <span class="font-bold text-2xl tracking-wide bg-gradient-to-r from-green-400 via-blue-400 to-purple-400 bg-clip-text text-transparent group-hover:from-green-300 group-hover:to-purple-300 transition">TBCreates</span>
      </a>
      <!-- Centered Nav Links -->
      <div class="flex-1 flex justify-center">
        <nav class="flex space-x-8 text-base font-medium">
          <a href="index.html" class="nav-link text-gray-300 hover:text-green-400 transition relative focus:outline-none focus:ring-2 focus:ring-green-400 rounded-xl">
            Home
            <span class="nav-underline"></span>
          </a>
          <a href="#" aria-current="page" class="nav-link text-gray-300 hover:text-green-400 transition relative border-b-2 border-green-400 pb-1 focus:outline-none focus:ring-2 focus:ring-green-400 rounded-xl">
            Events
            <span class="nav-underline"></span>
          </a>
          <a href="https://tbcreates.the-best.uk/" target="_blank" rel="noopener" class="nav-link text-gray-300 hover:text-green-400 transition relative focus:outline-none focus:ring-2 focus:ring-green-400 rounded-xl">
            Discord
            <span class="nav-underline"></span>
          </a>
        </nav>
      </div>
      <!-- Discord login/profile (right) -->
      <nav class="flex items-center space-x-4 ml-auto" id="discordProfileNav">
        <button id="discordLoginBtn" class="bg-[#5865F2] hover:bg-[#4752c4] text-white px-4 py-2 rounded-lg font-semibold flex items-center gap-2 transition focus:outline-none focus:ring-2 focus:ring-blue-400">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M20.317 4.369a19.791 19.791 0 0 0-16.634 0A2.285 2.285 0 0 0 2 6.477v11.046a2.285 2.285 0 0 0 1.683 2.108 19.791 19.791 0 0 0 16.634 0A2.285 2.285 0 0 0 22 17.523V6.477a2.285 2.285 0 0 0-1.683-2.108zM9.545 15.568V8.432l6.545 3.568-6.545 3.568z"/></svg>
          Login with Discord
        </button>
        <div id="discordProfile" class="hidden relative flex items-center gap-2">
          <img id="discordAvatar" src="" alt="Avatar" class="w-8 h-8 rounded-full border-2 border-[#5865F2] cursor-pointer select-none" aria-haspopup="true" aria-expanded="false" tabindex="0">
          <span id="discordUsername" class="font-semibold text-white cursor-pointer select-none" aria-haspopup="true" aria-expanded="false" tabindex="0"></span>
          <!-- Dropdown -->
          <div id="discordDropdown" class="absolute right-0 top-12 min-w-[140px] bg-[#232323] border border-[#333] rounded-xl shadow-lg py-2 dropdown-hidden z-50" role="menu">
            <button id="discordLogoutBtn" class="w-full text-left px-4 py-2 text-red-400 hover:bg-[#18181b] hover:text-red-300 transition font-semibold" role="menuitem">Logout</button>
          </div>
        </div>
      </nav>
    </nav>
  </header>

  <!-- MAIN CONTENT -->
  <main class="flex-1 w-full flex flex-col items-center px-2 sm:px-4">
    <section class="w-full max-w-3xl mt-10">
      <h2 class="text-4xl sm:text-5xl font-extrabold mb-8 text-center bg-gradient-to-r from-green-400 via-blue-400 to-purple-400 bg-clip-text text-transparent drop-shadow-2xl">
        Featured Events
      </h2>

      <!-- Event Card -->
      <div class="bg-[#191922]/90 rounded-2xl border border-[#232323] shadow-xl overflow-hidden flex flex-col md:flex-row transition hover:scale-[1.02] hover:shadow-2xl duration-200">
        <img src="https://cdn.discordapp.com/attachments/1311731875970289696/1381244551926386700/website.png?ex=6846cfbb&is=68457e3b&hm=5988befbd347b3f2f7cf6e0c97b378e0c6f9ba3ccb21d93897e9676340d5147e&" alt="FlatWorld Civ" class="md:w-2/5 w-full h-56 md:h-auto object-cover object-center rounded-t-2xl md:rounded-l-2xl md:rounded-tr-none">
        <div class="p-6 flex flex-col justify-between flex-1">
          <div>
            <h3 class="text-2xl font-bold mb-1 text-white">FlatWorld Civilisation</h3>
            <p class="text-sm text-blue-300 mb-3">by Thebestharrison1221</p>
            <p class="text-base text-gray-300 mb-6">
              Welcome to <span class="font-semibold text-green-400">FlatWorld Civilisation</span>! 
              You and other players are dropped into a vast, endless flat Minecraft world with almost no resources. 
              Work together or compete to gather materials, build your own empire from scratch, and defend your creations from others. 
              Trade, form alliances, or go solo—every decision shapes your story. 
              Can you rise to the top and become the ultimate FlatWorld ruler? 
              <span class="text-blue-400">Join now and prove your survival and building skills in this unique, community-driven event!</span>
            </p>
          </div>
          <button
            id="applyBtn"
            class="w-full bg-gradient-to-r from-green-400 to-blue-500 hover:from-green-500 hover:to-blue-600 text-white font-semibold py-3 rounded-lg shadow-lg transition text-lg focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-offset-2"
          >
            Apply for Event
          </button>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal -->
  <div id="applyModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 hidden transition-all duration-300" aria-modal="true" role="dialog">
    <div class="bg-[#232323] rounded-2xl shadow-2xl w-full max-w-lg mx-4 p-8 relative animate__animated animate__fadeInDown">
      <button id="closeModal" class="absolute top-4 right-4 text-gray-400 hover:text-red-400 text-2xl font-bold focus:outline-none focus:ring-2 focus:ring-red-400" aria-label="Close">&times;</button>
      <h2 class="text-2xl font-bold mb-4 text-white text-center">Apply for FlatWorld Civilisation</h2>
      <!-- Formspree Example Form -->
      <form id="eventForm" action="https://formspree.io/f/myzjegqa" method="POST" class="space-y-5">
        <div>
          <label class="block text-sm font-medium mb-1 text-gray-200" for="name">Minecraft Username</label>
          <input required type="text" id="name" name="Minecraft Username" class="w-full px-4 py-2 rounded-lg bg-[#18181b] border border-[#333] text-white focus:ring-2 focus:ring-green-400 outline-none" placeholder="Your Minecraft Username">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1 text-gray-200" for="age">Age</label>
          <input required type="number" min="7" max="99" id="age" name="Age" class="w-full px-4 py-2 rounded-lg bg-[#18181b] border border-[#333] text-white focus:ring-2 focus:ring-green-400 outline-none" placeholder="Your Age">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1 text-gray-200" for="experience">How long have you played Minecraft?</label>
          <select required id="experience" name="Experience" class="w-full px-4 py-2 rounded-lg bg-[#18181b] border border-[#333] text-white focus:ring-2 focus:ring-green-400 outline-none">
            <option value="">Select an option</option>
            <option value="Less than 1 year">Less than 1 year</option>
            <option value="1-2 years">1-2 years</option>
            <option value="3-5 years">3-5 years</option>
            <option value="5+ years">5+ years</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1 text-gray-200" for="why">Why do you want to join this event?</label>
          <textarea required id="why" name="Why Join" rows="3" class="w-full px-4 py-2 rounded-lg bg-[#18181b] border border-[#333] text-white focus:ring-2 focus:ring-green-400 outline-none" placeholder="Tell us why..."></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1 text-gray-200" for="discord">Discord Username (optional)</label>
          <input type="text" id="discord" name="Discord Username" class="w-full px-4 py-2 rounded-lg bg-[#18181b] border border-[#333] text-white focus:ring-2 focus:ring-green-400 outline-none" placeholder="yourname#1234">
        </div>
        <button type="submit" id="submitBtn" class="w-full bg-gradient-to-r from-green-400 to-blue-500 hover:from-green-500 hover:to-blue-600 text-white font-semibold py-3 rounded-lg shadow-lg transition text-lg">
          Submit Application
        </button>
        <div id="formSuccess" class="hidden text-green-400 text-center mt-3">Thank you! Your application has been submitted.</div>
        <div id="formDuplicate" class="hidden text-red-400 text-center mt-3">You have already applied for this event.</div>
      </form>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="bg-[#18181b] border-t border-[#232323] mt-16 py-10 text-gray-300 rounded-t-3xl shadow-2xl">
    <div class="max-w-6xl mx-auto px-6 flex flex-col md:flex-row items-center justify-between gap-10">
      <!-- Left: Logo & Brand -->
      <div class="flex items-center gap-4 mb-8 md:mb-0">
        <img src="https://cdn.discordapp.com/attachments/1311731875970289696/1381236274601660456/LOGO_2.png?ex=6846c805&is=68457685&hm=62072bd1ad22defcfb2ce11deb07e4554af23f72f493642d1fb30908c5ae6680&" class="w-12 h-12 rounded-2xl shadow-lg border-2 border-[#232323] bg-[#232323]/30" alt="Logo" />
        <div>
          <span class="font-extrabold text-white text-2xl tracking-wide">TBCreates</span>
          <div class="text-xs text-gray-400 mt-1">© 2025</div>
        </div>
      </div>
      <!-- Center: Socials -->
      <div class="flex flex-col items-center gap-3">
        <h4 class="text-white font-semibold text-lg mb-1 tracking-wide">Connect with us</h4>
        <div class="flex gap-6">
          <a href="https://tbcreates.the-best.uk/" target="_blank" class="hover:text-green-400 transition flex items-center gap-2 px-3 py-2 rounded-lg bg-[#232323]/50 hover:bg-[#232323]/80 shadow">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M20.317 4.369a19.791 19.791 0 0 0-16.634 0A2.285 2.285 0 0 0 2 6.477v11.046a2.285 2.285 0 0 0 1.683 2.108 19.791 19.791 0 0 0 16.634 0A2.285 2.285 0 0 0 22 17.523V6.477a2.285 2.285 0 0 0-1.683-2.108zM9.545 15.568V8.432l6.545 3.568-6.545 3.568z"/></svg>
            <span class="font-medium">Discord</span>
          </a>
          <a href="https://twitch.tv/thebestharrison1221" target="_blank" class="hover:text-purple-400 transition flex items-center gap-2 px-3 py-2 rounded-lg bg-[#232323]/50 hover:bg-[#232323]/80 shadow">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M21 2.5a2.5 2.5 0 0 1 2.5 2.5v14a2.5 2.5 0 0 1-2.5 2.5h-18A2.5 2.5 0 0 1 .5 19V5A2.5 2.5 0 0 1 3 2.5h18zm-9 3.5v12l8-6-8-6z"/></svg>
            <span class="font-medium">Twitch</span>
          </a>
          <a href="https://youtube.com/@thebestharrison1221" target="_blank" class="hover:text-red-400 transition flex items-center gap-2 px-3 py-2 rounded-lg bg-[#232323]/50 hover:bg-[#232323]/80 shadow">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M21.8 8.001s-.2-1.4-.8-2c-.7-.8-1.5-.8-1.9-.9C16.1 5 12 5 12 5h-.1s-4.1 0-7.1.1c-.4 0-1.2.1-1.9.9-.6.6-.8 2-.8 2S2 9.6 2 11.2v1.6c0 1.6.2 3.2.2 3.2s.2 1.4.8 2c.7.8 1.7.8 2.1.9C7.9 19 12 19 12 19s4.1 0 7.1-.1c.4 0 1.2-.1 1.9-.9.6-.6.8-2 .8-2s.2-1.6.2-3.2v-1.6c0-1.6-.2-3.2-.2-3.2zM10 15V9l6 3-6 3z"/></svg>
            <span class="font-medium">YouTube</span>
          </a>
          <a href="https://github.com/Thebestharrison1221" target="_blank" class="hover:text-blue-400 transition flex items-center gap-2 px-3 py-2 rounded-lg bg-[#232323]/50 hover:bg-[#232323]/80 shadow">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12c0 4.418 2.867 8.166 6.839 9.489.5.092.682-.217.682-.483 0-.237-.009-.868-.014-1.703-2.782.604-3.369-1.342-3.369-1.342-.454-1.154-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.004.07 1.532 1.032 1.532 1.032.892 1.529 2.341 1.088 2.91.832.091-.647.35-1.088.636-1.339-2.221-.253-4.555-1.111-4.555-4.945 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.272.098-2.65 0 0 .84-.269 2.75 1.025A9.564 9.564 0 0 1 12 6.844c.85.004 1.705.115 2.504.337 1.909-1.294 2.748-1.025 2.748-1.025.546 1.378.202 2.397.1 2.65.64.699 1.028 1.592 1.028 2.683 0 3.842-2.337 4.688-4.566 4.937.359.309.678.919.678 1.852 0 1.336-.012 2.417-.012 2.747 0 .268.18.579.688.481C19.135 20.163 22 16.417 22 12c0-5.523-4.477-10-10-10z"/></svg>
            <span class="font-medium">GitHub</span>
          </a>
        </div>
      </div>
      <!-- Right: Legal & Credits -->
      <div class="text-xs text-gray-400 text-center md:text-right max-w-xs leading-relaxed">
        <span class="block mb-2">Not affiliated with Mojang or Microsoft.</span>
        <span class="block">Made with <span class="text-pink-400">♥</span> by the <span class="font-semibold text-white">TBCreates</span> team.</span>
        <span class="block mt-2">
          <a href="mailto:admin@the-best.uk" class="underline hover:text-blue-400 transition">Contact Us</a>
        </span>
      </div>
    </div>
  </footer>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <script>
    // Page transition animation for internal links
    document.querySelectorAll('a[href]').forEach(link => {
      const isInternal = link.hostname === window.location.hostname && !link.target && !link.href.includes('#');
      if (isInternal) {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const fadePage = document.getElementById('fadePage');
          fadePage.classList.add('fade-out');
          setTimeout(() => {
            window.location.href = link.href;
          }, 350);
        });
      }
    });

    // On page load, fade in
    window.addEventListener('DOMContentLoaded', () => {
      document.getElementById('fadePage').classList.remove('fade-out');
      // Discord login/profile logic
      if (window.location.hash && window.location.hash.includes('access_token')) {
        const hash = window.location.hash.substr(1);
        const params = new URLSearchParams(hash);
        const accessToken = params.get('access_token');
        if (accessToken) {
          history.replaceState(null, '', window.location.pathname + window.location.search);
          fetch('https://discord.com/api/users/@me', {
            headers: { Authorization: `Bearer ${accessToken}` }
          })
          .then(res => res.json())
          .then(user => {
            showDiscordProfile(user);
            sessionStorage.setItem('discord_user', JSON.stringify(user));
          });
        }
      } else if (sessionStorage.getItem('discord_user')) {
        const user = JSON.parse(sessionStorage.getItem('discord_user'));
        showDiscordProfile(user);
      }
    });

    // Modal open/close logic
    const applyBtn = document.getElementById('applyBtn');
    const applyModal = document.getElementById('applyModal');
    const closeModal = document.getElementById('closeModal');
    const eventForm = document.getElementById('eventForm');
    const formSuccess = document.getElementById('formSuccess');
    const formDuplicate = document.getElementById('formDuplicate');
    const submitBtn = document.getElementById('submitBtn');

    // Unique event key for localStorage (change if you have multiple events)
    const EVENT_KEY = 'applied_flatworld_civilisation';

    if (applyBtn) {
      applyBtn.addEventListener('click', () => {
        if (localStorage.getItem(EVENT_KEY)) {
          formDuplicate.classList.remove('hidden');
          formSuccess.classList.add('hidden');
          submitBtn.disabled = true;
          submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
        } else {
          formDuplicate.classList.add('hidden');
          submitBtn.disabled = false;
          submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }
        applyModal.classList.remove('hidden');
        applyModal.classList.add('flex');
      });
    }

    if (closeModal) {
      closeModal.addEventListener('click', () => {
        applyModal.classList.add('hidden');
        applyModal.classList.remove('flex');
        eventForm.reset();
        formSuccess.classList.add('hidden');
        formDuplicate.classList.add('hidden');
        submitBtn.disabled = false;
        submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
      });
    }

    if (eventForm) {
      eventForm.addEventListener('submit', function(e) {
        e.preventDefault();
        if (localStorage.getItem(EVENT_KEY)) {
          formDuplicate.classList.remove('hidden');
          formSuccess.classList.add('hidden');
          submitBtn.disabled = true;
          submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
          return;
        }
        const data = new FormData(eventForm);
        fetch(eventForm.action, {
          method: "POST",
          body: data,
          headers: { 'Accept': 'application/json' }
        }).then(response => {
          if (response.ok) {
            localStorage.setItem(EVENT_KEY, "true");
            formSuccess.classList.remove('hidden');
            formDuplicate.classList.add('hidden');
            submitBtn.disabled = true;
            submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
            setTimeout(() => {
              applyModal.classList.add('hidden');
              applyModal.classList.remove('flex');
              eventForm.reset();
              formSuccess.classList.add('hidden');
            }, 2000);
          }
        });
      });
    }

    if (applyModal) {
      applyModal.addEventListener('click', function(e) {
        if (e.target === applyModal) {
          applyModal.classList.add('hidden');
          applyModal.classList.remove('flex');
          eventForm.reset();
          formSuccess.classList.add('hidden');
          formDuplicate.classList.add('hidden');
          submitBtn.disabled = false;
          submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }
      });
    }

    // Discord OAuth2 config
    const DISCORD_CLIENT_ID = '1345155304106754140';
    const DISCORD_REDIRECT_URI = 'https://the-best.uk/index.html';
    const DISCORD_SCOPE = 'identify';
    const DISCORD_AUTH_URL = `https://discord.com/api/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&redirect_uri=${encodeURIComponent(DISCORD_REDIRECT_URI)}&response_type=token&scope=${DISCORD_SCOPE}`;

    const discordLoginBtn = document.getElementById('discordLoginBtn');
    const discordProfile = document.getElementById('discordProfile');
    const discordUsername = document.getElementById('discordUsername');
    const discordAvatar = document.getElementById('discordAvatar');
    const discordLogoutBtn = document.getElementById('discordLogoutBtn');
    const discordDropdown = document.getElementById('discordDropdown');

    // Show Discord login/profile in navbar
    function showDiscordProfile(user) {
      discordLoginBtn.style.display = 'none';
      discordProfile.classList.remove('hidden');
      discordUsername.textContent = user.username + (user.discriminator ? '#' + user.discriminator : '');
      discordAvatar.src = user.avatar
        ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`
        : 'https://cdn.discordapp.com/embed/avatars/0.png';
    }

    // Discord login button click
    if (discordLoginBtn) {
      discordLoginBtn.addEventListener('click', () => {
        window.location.href = DISCORD_AUTH_URL;
      });
    }

    // Dropdown logic: click to toggle
    let dropdownOpen = false;

    // Accessibility: ARIA for dropdown
    function setDropdownAria(open) {
      discordUsername.setAttribute('aria-expanded', open ? 'true' : 'false');
      discordAvatar.setAttribute('aria-expanded', open ? 'true' : 'false');
    }

    function toggleDropdown(e) {
      e.stopPropagation();
      dropdownOpen = !dropdownOpen;
      setDropdownAria(dropdownOpen);
      if (dropdownOpen) {
        discordDropdown.classList.remove('dropdown-hidden');
        discordDropdown.classList.add('dropdown-visible');
        discordDropdown.querySelector('button').focus();
      } else {
        discordDropdown.classList.remove('dropdown-visible');
        discordDropdown.classList.add('dropdown-hidden');
      }
    }

    discordUsername.addEventListener('click', toggleDropdown);
    discordAvatar.addEventListener('click', toggleDropdown);

    // Keyboard accessibility for dropdown (Enter/Space)
    discordUsername.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        toggleDropdown(e);
      }
    });
    discordAvatar.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        toggleDropdown(e);
      }
    });

    // Hide dropdown on click outside
    document.addEventListener('click', function(e) {
      if (dropdownOpen && !discordProfile.contains(e.target)) {
        discordDropdown.classList.remove('dropdown-visible');
        discordDropdown.classList.add('dropdown-hidden');
        dropdownOpen = false;
        setDropdownAria(false);
      }
    });

    // Logout button
    if (discordLogoutBtn) {
      discordLogoutBtn.addEventListener('click', () => {
        sessionStorage.removeItem('discord_user');
        discordProfile.classList.add('hidden');
        discordLoginBtn.style.display = '';
        dropdownOpen = false;
        discordDropdown.classList.remove('dropdown-visible');
        discordDropdown.classList.add('dropdown-hidden');
      });
    }

    // Trap focus in modal when open
    if (applyModal) {
      applyModal.addEventListener('keydown', function(e) {
        if (e.key === 'Tab') {
          const focusable = applyModal.querySelectorAll('input, select, textarea, button, [tabindex]:not([tabindex="-1"])');
          const first = focusable[0];
          const last = focusable[focusable.length - 1];
          if (e.shiftKey ? document.activeElement === first : document.activeElement === last) {
            e.preventDefault();
            (e.shiftKey ? last : first).focus();
          }
        }
        if (e.key === 'Escape') {
          applyModal.classList.add('hidden');
          applyModal.classList.remove('flex');
        }
      });
    }
  </script>
</body>
</html>